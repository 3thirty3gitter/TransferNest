---
id: PM-20240905-1200-ui-input-bug
created_at: 2024-09-05T12:00:00Z
updated_at: 2024-09-05T12:00:00Z
projects: [TransferNest]
systems: [ui-components]
tags: [bug, react, ui]
severity: medium
status: resolved
checkpoint: f124263
provenance:
  origin_paths: []
  commits: []
  imported_from: "Internal user report"
  hash: 1a8b9c7d6e5f4g3h2i1j0k9l8m7n6o5p4q3r2s1t
superseded_by: null
---

## Post-Mortem: UI Input Bug Prevents Multi-Digit Dimension Entry

- **ID:** PM-20240905-1200-ui-input-bug
- **Date:** 2024-09-05T12:00:00Z
- **Scope:** `src/components/image-card.tsx`.
- **Symptoms:** The "Width" and "Height" input fields on the Image Card in the Nesting Tool did not allow users to enter more than a single digit. After typing one character, the input would lose focus or reset, making it impossible to enter a number like "12.5".
- **Timeline:**
  - `T0`: User reported the inability to enter multi-digit numbers in the dimension fields.
- **Root Cause:** A flaw in the component's state management. The `value` prop of the `<Input>` component was directly bound to a prop from the parent (`image.width` or `image.height`) which was formatted using `.toFixed(2)`. The `onChange` handler would trigger an update, re-rendering the component and immediately re-formatting the input value to a two-decimal number. This continuous re-formatting cycle prevented users from typing a multi-digit string.
- **Evidence:** Code inspection of `src/components/image-card.tsx` showed the `value` of the `Input` was tied directly to the formatted prop, and `onUpdate` was called on every `onChange` event.
- **Fix:**
  1.  Introduced local state variables (`localWidth`, `localHeight`) within the `ImageCard` component to store the raw string value of the input fields as the user types.
  2.  The `onChange` handlers were updated to modify this local string state, allowing for uninterrupted user input.
  3.  The `onUpdate` call, which parses the string to a number and updates the parent state, was moved from the `onChange` event to the `onBlur` event. This ensures the parent state is only updated once the user has finished typing and clicks away from the input.
  4.  A `useEffect` hook was added to synchronize the local state with the parent props, ensuring that changes from external events (like aspect ratio calculations) are reflected in the input fields.
- **Validation:** After the fix, users can freely type multi-digit decimal numbers into the "Width" and "Height" fields. The aspect ratio lock continues to function correctly, updating the other dimension field on blur.
- **Blast Radius:** This was a significant usability issue for the core nesting tool feature, preventing users from accurately sizing their images.
- **Regression Risk:** Low. The fix is self-contained within the `ImageCard` component and improves its state management without altering its props or external API.
- **Lessons Learned:**
  - When creating controlled inputs for numeric values that require formatting, use a separate local string state for the user's raw input. Only parse, validate, and propagate this value to the parent state on a discrete event like `onBlur`, not on every `onChange`. This avoids interrupting the user's typing flow with premature re-formatting.
- **Preventive Controls:**
  - Code reviews for UI components with numeric inputs should specifically check for this pattern of separating raw input state from formatted parent state.
- **Rollback Plan:** Revert the file `src/components/image-card.tsx` to its previous version from the repository history.
- **Owners:** N/A
- **Related Incidents:** N/A
